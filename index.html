<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DFA/PDA Challenge</title>
  <style>
    body { background: #111; color: #eee; font-family: sans-serif; padding: 20px; }
    h1 { font-size: 24px; }
    .section { background: #1d1d1d; border: 1px solid #333; padding: 10px; margin: 10px 0; border-radius: 5px; }
    .stack-view { background: #222; padding: 10px; font-family: monospace; margin-top: 10px; }
    .input-box, select, button, textarea { margin-top: 5px; display: block; width: 100%; padding: 5px; background: #333; color: #eee; border: none; border-radius: 3px; }
    button:hover { background: #555; cursor: pointer; }
    .hidden { display: none; }
  </style>
</head>
<body>
  <h1>DFA/PDA Challenge</h1>
  <label><input type="checkbox" id="enablePDA" onchange="resetChallenge()"> Enable PDA Challenges</label>
  <div id="mission"></div>
  <div id="alphabet"></div>

  <div class="section">
    <h3>Test Your Automaton</h3>
    <input class="input-box" id="test-string" placeholder="Enter input string" />
    <button onclick="runSimulation()">Test</button>
    <div id="result"></div>
    <div class="stack-view" id="stack-view"></div>
  </div>

  <script>
    const alphabets = [['a', 'b'], ['a', 'b', 'c'], ['0', '1']];
    const templates = [
      (_) => ({ type: "PDA", rule: "be a palindrome", test: s => s === s.split('').reverse().join('') }),
      (_) => ({ type: "PDA", rule: "contain no repeating characters", test: s => new Set(s).size === s.length }),
      (a) => { const x = r(a); return { type: "DFA", rule: `start with '${x}'`, test: s => s.startsWith(x) }; },
      (a) => { const x = r(a); return { type: "DFA", rule: `end with '${x}'`, test: s => s.endsWith(x) }; },
      (a) => { const x = r(a); return { type: "DFA", rule: `have even number of '${x}'`, test: s => s.split('').filter(c => c === x).length % 2 === 0 }; },
      (a) => { const x = r(a); return { type: "DFA", rule: `have odd number of '${x}'`, test: s => s.split('').filter(c => c === x).length % 2 === 1 }; },
      (a) => { const x = r(a); return { type: "DFA", rule: `contain '${x}' exactly once`, test: s => s.split('').filter(c => c === x).length === 1 }; }
    ];

    let currentMission, currentAlphabet;

    function r(a) { return a[Math.floor(Math.random() * a.length)]; }

    function resetChallenge() {
      const enablePDA = document.getElementById('enablePDA').checked;
      currentAlphabet = r(alphabets);
      const filtered = templates.filter(t => enablePDA || t(currentAlphabet).type === "DFA");
      currentMission = r(filtered)(currentAlphabet);
      document.getElementById('mission').innerText = `Mission: Create a ${currentMission.type} that will ${currentMission.rule}`;
      document.getElementById('alphabet').innerText = `Alphabet: { ${currentAlphabet.join(', ')} }`;
      document.getElementById('result').innerText = '';
      document.getElementById('stack-view').innerText = '';
    }

    function runSimulation() {
      const input = document.getElementById('test-string').value.trim();
      const missionType = currentMission.type;
      const rule = currentMission.rule;

      let resultText = '';
      let stack = [];

      if (missionType === 'PDA' && rule.includes("palindrome")) {
        const mid = Math.floor(input.length / 2);
        for (let i = 0; i < mid; i++) stack.push(input[i]);
        let j = input.length % 2 === 0 ? mid : mid + 1;
        while (j < input.length) {
          const top = stack.pop();
          if (top !== input[j]) {
            resultText = `❌ Rejected. Mismatch at index ${j}: expected '${top}', found '${input[j]}'`;
            break;
          }
          j++;
        }
        if (stack.length === 0 && !resultText) resultText = `✅ Accepted as a palindrome.`;
      }
      else if (missionType === 'PDA' && rule.includes("no repeating characters")) {
        const seen = new Set();
        for (let i = 0; i < input.length; i++) {
          if (seen.has(input[i])) {
            resultText = `❌ Rejected. '${input[i]}' repeated at index ${i}`;
            break;
          }
          seen.add(input[i]);
        }
        if (!resultText) resultText = `✅ Accepted. No repeating characters.`;
      }
      else if (missionType === 'DFA') {
        const expected = currentMission.test(input);
        resultText = expected ? `✅ Accepted.` : `❌ Rejected.`;
      }

      document.getElementById('result').innerText = resultText;
      document.getElementById('stack-view').innerText = missionType === 'PDA' ? `Stack: [${stack.join(', ')}]` : '';
    }

    resetChallenge();
  </script>
</body>
</html>
